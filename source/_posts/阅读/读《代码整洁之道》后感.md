---
title: '读《代码整洁之道（Clean Code）》后感'
date: 2015-11-22 17:43:19
tags: 
- Reading
---

《Clean Code》是一本不太厚的书，在大学时就拜读过，工作一段时间后又重拾读了一遍，又有了些新的感悟，再次略做随笔。

如果时间退回到大学，包括《Clean Code》，《重构》，《设计模式》此类书必然被我奉为神书，战战兢兢地写着代码，生怕哪里违反了什么什么准则，什么什么约定。

工作几年后看，并不是这样。更多了一些淡然，或者说破罐子破摔？大误。

例如书中强调对类、方法、变量的最合理的命名，而减少注释。事实是，即使在当下这家不错的互联网公司，对英语的理解力都是不足的，更别说前几家东家中还存在着大量的技艺勉强，英语更不敢评价的外包员工。连命名都困难的话，如果仅仅依靠代码理解业务逻辑，更是不敢想象。因此实践中，前 TL 也是强制对代码注释提了需求，也是可以理解的。

Coding 进入实际工程，准则和约定都多了不少妥协。但程序员，或者是工程师们，在当代即是一类工匠。工匠们不仅产出手艺成品，也产出智力产品。工匠需要工匠精神，对程序员而言，就是整洁高效的代码。

这是一种哲学理念。所谓 “格物致知”，从代码就能看出一个程序员对自己技术的追求。



在书中，也提到了对代码的 5S 哲学，包括：

- 整理（Seiri），理清事物本质，并善于设计
- 整顿（Seiton），系统化，物皆有其位，而后物尽归其位
- 清楚（Seiso），命名注释清晰，无废弃代码
- 清洁（Seihetsu），标准化
- 身美（Shitsuke），自律、持续迭代、重构



一个优秀的程序员，必定会对自己的技艺不断的追求精进，格物致知，码品如人品。

<!-- more -->
书中罗列了一些准则，在此记录，以不断自省。前几点多为已经习以为常的准则，而并发一节作为编程时的难点，需额外关注。



# 准则规范

## 强调命名
1. 命名要清晰，长一点但更清晰的命名，要好于短一点依赖注释说明的命名
2. 命名减少无意义的信息，如 “Info，Data” 等后缀冗余，或者是大家皆有的前缀冗余
3. 遵循一般约定的命名法则，如匈牙利命名法
4. 强调语境，例如 Address 远不如 IP，Port，MAC，URI 等清晰明确

<br />

## 函数
1. 短小，上百行的函数一定不是好的设计
2. 只做一件事，做好这件事。一件事定义可大可小，如果不够明确，那么进行精炼短小的拆分会是个不错的选择
3. 向下规则。就如同阅读新闻摘要，将最主要的信息至于最上方，例如最上方是接口实现，之后是 private 方法
4. 精简函数入参，应尽量避免三个或三个以上的入参。如果参数实在过多，就将其组成一个 entity 吧
5. 使用异常替代返回错误码
6. 重视复用，不要重复造轮子。两个轮子，就需要维护两处地方，没人希望那么干。

<br />

## 关于注释
1. 注释不能美化糟糕的代码，代码逻辑不清就立即修改或重构，不要依赖于注释！
2. 能用命名解决的，就减少注释吧
3. 注释需提供有效信息，例如阐述意图，提供警示(如说明 not thread safe)。虽然有些算法通过代码可以理清逻辑，但通过注释说明一下也是个好方法
4. 别说废话，如果一个方法真的清晰简单，那么循规蹈矩的写 javadoc 是不必要的
5. 学会利用版本控制工具，如 git。不要保留被注释了的代码，也不要保留日志式的修改记录

<br/>

## 格式
代码格式有诸多的工具可以帮助一键式格式标准化。学会利用工具提高效率。
不要试图产出一种自己定义的代码风格格式，这会对他人造成困扰，尽量用约定俗成的！

## 对象和数据结构
1. 面向接口编程
2. 得墨忒耳律，模块不应了解其操作对象的内部情况
3. 有时候，面向过程编码足矣，不需要 OO

<br/>

## 错误处理
1. 使用异常，而非错误码
2. 别传递和返回 NULL

<br />

## 边界
清晰设计代码模块，明确类或方法的功能。可以学习一下设计模式

<br/>

## 单元测试
1. TDD 测试驱动编程。三定律：
   - 定律一：在编写不能通过的单测前，不可编写生产代码
   - 定律二：只可编写刚好无法通过的单测，不能编译不算通过
   - 定律三：只可编写刚好足以通过当前失败 case 的生产代码
2. 测试代码与生产代码同样重要，要时常更新保持生产代码运行时都可顺畅的通过测试
3. 测试代码可以稍微降低对效率的要求
4. 测试军规 F.I.R.S.T
   - 快速(First)，可快速执行测试 case
   - 独立(Independent)，测试 case 间独立
   - 可重复(Repeatable)，可在任何环境重用
   - 自足验证(Self-Validating)
   - 及时(Timely)，及时编写，保持与生产代码同步

<br/>

## 类
1. 类的设计应遵循高内聚、低耦合的原则。内聚高意味着类中的方法和变量相互依赖，最高程度的内聚是类中的变量在类内的所有方法中均被使用。
2. 遵守单一权责原则

<br/>

## 系统
1. Spring 是个很好的框架，需要深入理解其 IoC 和 AOP
2. 测试驱动系统架构。不要 BDUF (Big Design Up Front)

<br/>

## 迭代，持续改进
代码简单，只要依次遵守以下规则
1. 可运行所有测试
2. 不可重复
3. 清晰表达了程序员的意图
4. 尽可能减少类和方法的数量

运行所有测试：面向 TDD 的编程可以在编写生产代码的过程中，就充分考虑到解耦合、明确设计，不断改进代码。消除了对清理代码的恐惧。
重构：2~4，良好的设计模式不可或缺

<br/>

# 参考资料

[1] 《代码整洁之道》（《Clean Code——A Handbook of Agile Software Craftsmanship》) , Robert C.Martin 著， 韩磊 译，人民邮电出版社