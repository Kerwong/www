---
title: 'æ¢ç´¢ Java ä¸­ String çš„æœ¬è´¨ï¼Œä» char è¯´èµ·'
date: 2015-6-17 21:11:09
tags: 
- Java
- JVM
- æœ€ä½³å®è·µ
---

`String` ç±»å¯ä»¥è®¤ä¸ºæ˜¯ Java è¯­è¨€ä¸­æœ€ä¸ºå¸¸ç”¨çš„ç±»äº†ï¼Œå¯¹äº `String` çš„ç†è§£æ›´æ˜¯ Java é¢è¯•é¢˜çš„å¸¸å®¢ã€‚
ä½†ä½œä¸ºä¸€ä¸ª Java ç¨‹åºå‘˜ï¼Œå¯¹äº `String` æ˜¯å¦è¶³å¤Ÿäº†è§£äº†å‘¢ï¼Ÿ
æœ¬ç¯‡æ–‡ç« å°†å¯¹ `String`çš„å­˜å‚¨ï¼Œä½¿ç”¨åšä¸€ä¸ªè¯¦ç»†çš„æ¢è®¨ã€‚
<br/>
å…ˆæ¥ç®€å•ä»‹ç»ä¸‹ `String`ï¼Œ`String`æ˜¯ JDK æä¾›çš„ä½äº `java.lang` ä¸­çš„åŸºç¡€ç±»ï¼Œä½†åŒºåˆ«äº `byteï¼Œshortï¼Œintï¼Œlongï¼Œcharï¼Œbooleanï¼Œfloatï¼Œdouble`è¿™äº›åŸºæœ¬ç±»å‹ï¼Œ`String`ä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»ã€‚
å› ä¸ºæ˜¯ç±»ï¼Œå®ä¾‹åŒ–çš„`String` å¯¹è±¡çš„ç©ºå€¼ä¸º `null`ï¼Œä½†`String`æ˜¯å¦‚æ­¤å¸¸ç”¨ï¼Œäºæ˜¯ JDK å¯¹å…¶æœ‰ç‰¹æ®Šçš„ä¼˜åŒ–ã€‚
<!--more-->
<br/>

# String çš„å­˜åœ¨å½¢å¼
ä¸Šæ–‡æåˆ°ï¼Œ`String`æ˜¯ JDK æä¾›çš„ç±»ï¼Œè¦å­¦ä¹  JDKï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯é˜…è¯»å…¶æºç ã€‚

```java
public final class String
    implements java.io.Serializable, Comparable<String>, CharSequence {
    /** The value is used for character storage. */
    private final char value[];
    ...
```
åˆ†ææºç å¯ä»¥çŸ¥é“ï¼ŒJava ä¸­`String` æ˜¯ä»¥ `char æ•°ç»„`çš„å½¢å¼å­˜åœ¨çš„ã€‚
<br/>

## è®¨è®ºä¸‹ Java ä¸­çš„ char ç±»å‹
`char` åŸºæœ¬æ•°æ®ç±»å‹æ˜¯ Java ä¸­ç”¨äºå­˜å‚¨å­—ç¬¦çš„ã€‚`String` å°±æ˜¯ä»¥ `charæ•°ç»„`å½¢å¼å­˜å‚¨çš„ï¼Œè¦ç†è§£ `String` å°±å¿…é¡»å…ˆäº†è§£ `char`ã€‚
ä½†åœ¨è®¨è®º `char` ä¹‹å‰ï¼Œè¿˜éœ€è¦ä»‹ç»å¦å¤–ä¸¤ç‚¹çŸ¥è¯†ã€‚
<br/>

### ç¼–ç  unicode vs UTF
unicodeï¼Œç§°ä¸ºç»Ÿä¸€å­—ç¬¦ç¼–ç ï¼Œæ˜¯å›½é™…ä¸Šå¯¹åƒå¥‡ç™¾æ€ªå­—ç¬¦çš„ç»Ÿä¸€çš„**ç¼–å·**ã€‚unicode æœ€åˆçš„ 256 ä¸ªå­—ç¬¦ï¼Œæ˜¯ç»§æ‰¿äº ASCII ç¼–ç ã€‚ä¾‹å¦‚è‹±æ–‡å­—æ¯ `a`ï¼Œåœ¨ unicode ä¸­ç¼–å·ä¸º 97ï¼Œä¸­æ–‡ `æˆ‘` å­—ï¼Œåœ¨ unicode ä¸­çš„ç¼–å·å°±æ˜¯ 25105ã€‚ç®€å•çš„è¯´ï¼Œunicode å°±æ˜¯ç»Ÿä¸€çš„å­—ç¬¦ç¼–å·ã€‚ä½†æ˜¯ï¼Œè¿™ä¹ˆå¤šå­—ç¬¦å¦‚ä½•åœ¨ä»£ç ä¸­è¡¨ç¤ºå‘¢ï¼Ÿè¿™ä¾¿æ˜¯ UTFã€‚

<br/>

UTFï¼Œunicode è½¬æ¢æ ¼å¼(Unicode Transformation Format)ï¼ŒUTF æœ‰å¤šç§ç¼–ç æ–¹å¼ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å°±æ˜¯ `UTF-8` å’Œ `UTF-16`ï¼Œè¿™ä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼Œ`UTF-8` ä¿¡æ¯å¯†åº¦æ›´é«˜ï¼Œä¼ è¾“ã€å­˜å‚¨æ•ˆç‡æ›´é«˜ï¼Œ`UTF-16`å­—ç¬¦å¯¹é½ï¼Œæ˜“äºç¨‹åºå¤„ç†ï¼Œåˆ©äºä¼˜åŒ–è®¡ç®—æ•ˆç‡ã€‚ä½¿ç”¨åº”è§†æƒ…å½¢è€Œå®šã€‚

- `UTF-8` æ˜¯é€šè¿‡å˜é•¿æ¥è¡¨ç¤º unicode å­—ç¬¦çš„ï¼Œä»¥ byte ä¸ºå•ä½ï¼Œé•¿åº¦èŒƒå›´ 1~6ã€‚ä¾‹å¦‚ `a` ç¼–å·æ˜¯ 97ï¼Œå°±ç”¨ä¸€ä¸ª byteï¼Œä¹Ÿå°±æ˜¯ 8 bit æ¥ç¼–ç ï¼Œè€Œ `æˆ‘` çš„ç¼–å·æ˜¯ 25105ï¼Œä¸€ä¸ª byte æ— æ³•ç¼–ç ï¼Œäºæ˜¯å°±ç”¨ 2ä¸ª byte æ¥ç¼–ç ã€‚
- `UTF-16` åˆ™æ˜¯å›ºå®šé•¿åº¦ç¼–ç ã€‚ç»Ÿä¸€ç”¨ 2 byteï¼Œä¹Ÿå°±æ˜¯ 16bit è¿›è¡Œç¼–ç ï¼Œä½† unicode å½“å‰å­—ç¬¦é›†å·²ç»è¶…å‡º 16bit æ‰€èƒ½ç¼–ç èŒƒå›´äº†(16bitï¼Œå¯å¯¹ 2^16 = 65536 ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç )ï¼Œå› æ­¤ä¹Ÿä¼šç”¨ 4 byte æ¥è¡¨ç¤ºã€‚



<br/>

### å†…ç ä¸å¤–ç 
å†…ç  internal encodingï¼Œå¤–ç  external encoding
- å†…ç æ˜¯è¯­è¨€è¿è¡Œæ—¶ï¼Œ`char` åœ¨å†…å­˜ä¸­çš„ç¼–ç æ–¹å¼ã€‚
- å¤–ç æ˜¯é™¤äº†å†…ç ä»¥å¤–çš„ç¼–ç ï¼Œä¾‹å¦‚æºç ç¼–è¯‘ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶(å¯æ‰§è¡Œæ–‡ä»¶ã€.class æ–‡ä»¶)ä¸­çš„ç¼–ç å‡ä¸ºå¤–ç ã€‚

<br/>

### é‚£ä¹ˆ Java ä¸­çš„ char å‘¢ï¼Ÿ
`char` æ˜¯ Java çš„åŸºæœ¬ç±»å‹ä¹‹ä¸€ï¼Œç”¨æ¥è¡¨ç¤ºå­—ç¬¦ã€‚
JVM é‡‡ç”¨çš„å†…ç ï¼Œæ˜¯ `UTF-16`ï¼Œä¹Ÿå°±æ˜¯è¯´ **Java ä¸­çš„ char çš„é•¿åº¦ä¸º 2 byteï¼Œå³ 16 bit**ã€‚
ä½†ä¸Šæ–‡æåˆ°ï¼Œä»… 16 bit å·²æ— æ³•è¡¨ç¤ºæ‰€æœ‰çš„ unicodeï¼Œå› æ­¤ä¸ºäº†å‘ä¸‹å…¼å®¹ï¼ŒJava çš„ char ä¿ç•™ä¸º 16bitï¼Œè‹¥æœ‰æ— æ³•ç”¨ 16 bit è¡¨ç¤ºçš„å­—ç¬¦ï¼Œåˆ™é‡‡ç”¨ 2 charï¼Œå³ 4 byteï¼Œ32 bit æ¥è¡¨ç¤ºã€‚

> Java çš„ class æ–‡ä»¶é‡‡ç”¨ UTF-8 å­˜å‚¨å­—ç¬¦ã€‚`char` åœ¨ class ä¸­ä»¥ `UTF-8` æ–¹å¼ç¼–ç ï¼ŒåŒºåˆ«äºå†…ç ä¸­çš„ `char`

<br/>

### `Character`ï¼Œå…³äº `char` çš„æ›´å¤š
Java é‡‡ç”¨ `UTF-16` ä¸ºå­—ç¬¦ç¼–ç ã€‚ä½† unicode å­—ç¬¦é›†å·²ç»è¶…å‡º 16bit æ‰€èƒ½è¡¨è¿°çš„èŒƒå›´ï¼Œå› æ­¤æœ‰äº›å­—ç¬¦ä¼šé‡‡ç”¨ 2charï¼Œå³ 32 bit è¿›è¡Œç¼–ç ã€‚
ä¸ºäº†æ–¹ä¾¿å¤„ç†ï¼ŒJava æä¾›äº† `Character` ç±»ã€‚`Character` å¯¹ `char` è¿›è¡Œäº†å°è£…ï¼Œå¹¶æä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œä¸»è¦æ˜¯`char` ç±»å‹çš„åˆ¤æ–­ï¼ˆæ˜¯æ•°å­—è¿˜æ˜¯ä¸­æ–‡ï¼‰ã€å¤§å°å†™è£…æ¢ã€æ¯”è¾ƒç­‰ç­‰ã€‚å…·ä½“æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ JDK æºç `java.lang.Character`ã€‚
<br/>
æåˆ° `Character`ï¼Œä¸»è¦æ˜¯å¼ºè°ƒä»¥ä¸‹å‡ ç‚¹ï¼š
1. `code point` vs `code unit`
  ç ä½ `code point`ï¼šæŒ‡å­—ç¬¦åœ¨ unicode å­—ç¬¦é›†ä¸­çš„ç¼–å·ï¼Œç”¨ `int` è¡¨ç¤ºï¼Œint ä¸º 32bitï¼Œç°é˜¶æ®µå¯è¡¨ç¤º unicode å­—ç¬¦é›†ã€‚èŒƒå›´ä¸º `U+0000 ~ U+10FFFF`ã€‚
  `code unit`ï¼šå¯¹åº”ä¸€ä¸ª `char`ï¼Œå¯ç”± 1ä¸ªæˆ– 2ä¸ª `code unit` ç»„æˆ `code point`ã€‚è¿™ä¸¤ä¸ªæ¦‚å¿µä¸»è¦æ¶‰åŠ `UTF-16` å®ç°ã€‚

2. åŸºæœ¬å¤šè¯­è¨€å¹³é¢ `Basic Multilingual Plane (BMP)` vs è¾…åŠ©å¹³é¢ `Supplementary Character`
  è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œæ˜¯é’ˆå¯¹ unicode å­—ç¬¦é›†è€Œè¨€ã€‚å½“å‰ Java æ”¯æŒçš„ unicode å­—ç¬¦é›†èŒƒå›´ä¸º `U+0000 ~ U+10FFFF`ï¼Œè‹¥è¶…å‡ºæ­¤èŒƒå›´ï¼Œåˆ™æ— æ³•å¤„ç†ã€‚
  `Basic Multilingual Plane (BMP)`ï¼šç”¨äºè¡¨ç¤º `U+0000 ~ U+FFFF` èŒƒå›´çš„å­—ç¬¦ã€‚
  `Supplementary Character`ï¼šunicode è¶…å‡º `U+FFFF` èŒƒå›´åï¼Œéœ€è¦ç”¨ 2ä¸ª char è¡¨ç¤ºï¼Œè¶…å‡ºéƒ¨åˆ†ç§°ä¸º `Supplementary Character`ï¼Œç”±äº `code point` èŒƒå›´æœ€å¤§ä¸º `U+10FFFF`ï¼Œæ‰€ä»¥ `Supplementary Character` æœ€å¤šä¸º 5bitï¼Œé«˜ä½çš„ 11bit å¿…é¡»å‡ä¸º 0ï¼Œå¦åˆ™è¡¨ç¤ºå­—ç¬¦è¶…å‡º Java å½“å‰å­—ç¬¦é›†èŒƒå›´ã€‚å¤„ç†å•ä¸ª `char`æ—¶ï¼Œä¸éœ€è¦ä½¿ç”¨ `Supplementary Character`ï¼Œå½“ä»¥ `int` è¡¨ç¤ºå­—ç¬¦æ—¶ï¼Œæ‰éœ€è¦ä½¿ç”¨ã€‚
  å…·ä½“å¯å‚è€ƒç»´åŸºç™¾ç§‘  [UTF-16](https://zh.wikipedia.org/wiki/UTF-16) ä»‹ç»ã€‚


<br/>


## String æ˜¯ char[]
ä»¥ä¸Šåˆ†ææºç ï¼ŒçŸ¥é“äº† `String` æ˜¯ä»¥ `final char[]` çš„å½¢å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”çŸ¥é“äº†ç”±äº Java é‡‡ç”¨ `UTF-16` ç¼–ç  unicodeï¼Œå› æ­¤æœ‰äº›å­—ç¬¦ç”± 2 char è¡¨ç¤ºã€‚

```java
int len1 = "1".length();  // = 1
int len2 = "æˆ‘".length();  // = 1
int len3 = "ğŸ˜‚".length(); // = 2

// ç”¨ä»¥ä¸‹æ–¹æ³•è·å¾—çœŸæ­£çš„ unicode å­—ç¬¦ä¸ªæ•°
String emoji = "ğŸ˜‚";
int len3 = emoji.codePointCount(0, emoji.length());
```
`String` ç±»ä¸­è¿˜æä¾›äº†ä¸€äº›å¸¸ç”¨çš„å­—ç¬¦å¤„ç†æ–¹æ³•ï¼Œå°†åœ¨ä¸‹é¢çš„å®è·µç« èŠ‚è¿›è¡Œä»‹ç»ï¼Œè®©æˆ‘ä»¬ä¸‹æ¥çœ‹çœ‹ `String` æ˜¯å¦‚ä½•åœ¨ JVM ä¸­å­˜å‚¨çš„ã€‚
<br/>

# Java ä¸­ String çš„å­˜å‚¨
1. `String` åº•å±‚æ˜¯ `final char[]`ï¼Œæ˜¯å¸¸é‡ã€‚åœ¨ JVM ä¸­ï¼Œä½äº**å­—ç¬¦ä¸²å¸¸é‡æ± **ã€‚æ‰€è°“å¸¸é‡ï¼Œå°±æ˜¯ä¸€æ—¦åˆ›å»ºï¼Œå°±ä¸æ— æ›´æ”¹ã€‚
2. åªè¦ `String` çš„å€¼å‘ç”Ÿå˜æ›´ï¼ŒJava çš„å¤„ç†æ–¹å¼æ˜¯æ–°å»ºä¸€ä¸ª `String`å¯¹è±¡ã€‚
3. ç”±äº `String` æ˜¯ç±»ï¼Œå…¶å®ä¾‹ä¸ºå¯¹è±¡ã€‚Java åœ¨å¤„ç†å¯¹è±¡ä¼ é€’æ˜¯ï¼Œå‡æ˜¯**å¼•ç”¨æ‹·è´**ã€‚
4. å¯¹ `String` çš„åªè¯»ï¼Œä»»ä½•å¼•ç”¨å‡ä¸ä¼šä¿®æ”¹å…¶å€¼ã€‚

<br/>

> JDK1.7 ä¸­ JVM æŠŠ`String`å¸¸é‡æ± ä»æ–¹æ³•åŒºä¸­ç§»é™¤äº†ï¼›JDK1.8 ä¸­ JVM æŠŠ`String`å¸¸é‡æ± ç§»å…¥äº†å †ä¸­ï¼ŒåŒæ—¶å–æ¶ˆäº†â€œæ°¸ä¹…ä»£â€ï¼Œæ”¹ç”¨å…ƒç©ºé—´ä»£æ›¿ï¼ˆMetaspaceï¼‰
>
> è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„å†…å®¹ï¼Œä¸»è¦æºäº class é™æ€å¸¸é‡æ± ï¼Œä¹Ÿå°±æ˜¯ç¼–è¯‘é˜¶æ®µç¡®å®šçš„å¸¸é‡æ± ã€‚ä½†ä¹Ÿå¯ä»¥é€šè¿‡ `String.intern()` æ–¹æ³•ï¼Œæ‰‹åŠ¨å°†å­—ç¬¦ä¸²å¸¸é‡æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œå¦åˆ™ JVM ä¸ä¼šä¸»åŠ¨æ·»åŠ å¸¸é‡è‡³å¸¸é‡æ± ã€‚



## ä¸ºä½•é€‰æ‹©å¸¸é‡æ± å­˜æ”¾ `String`
å¸¸é‡æ± æ˜¯ä¸ºäº†é¿å…é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å¯¹è±¡è€Œå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œå…¶å®ç°äº†å¯¹è±¡çš„å…±äº«ã€‚
ä¾‹å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±æŠŠæ‰€æœ‰çš„å­—ç¬¦ä¸²æ–‡å­—æ”¾åˆ°ä¸€ä¸ªå¸¸é‡æ± ä¸­ã€‚
1. èŠ‚çœå†…å­˜ç©ºé—´ï¼šå¸¸é‡æ± ä¸­æ‰€æœ‰ç›¸åŒçš„å­—ç¬¦ä¸²å¸¸é‡è¢«åˆå¹¶ï¼Œåªå ç”¨ä¸€ä¸ªç©ºé—´ã€‚
2. èŠ‚çœè¿è¡Œæ—¶é—´ï¼šæ¯”è¾ƒå­—ç¬¦ä¸²æ—¶ï¼Œ`==` æ¯” `equals()`å¿«ã€‚å¯¹äºä¸¤ä¸ªå¼•ç”¨å˜é‡ï¼Œåªç”¨`==`åˆ¤æ–­å¼•ç”¨æ˜¯å¦ç›¸ç­‰ï¼Œä¹Ÿå°±å¯ä»¥åˆ¤æ–­å®é™…å€¼æ˜¯å¦ç›¸ç­‰ã€‚
<br/>

## `String` ä½•æ—¶ä¸ºå¸¸é‡ï¼Œå…¥å¸¸é‡æ± 
ä½•æ—¶è§†ä¸ºå¸¸é‡ï¼Œä½•æ—¶å…¥å¸¸é‡æ± ï¼Ÿå…ˆäº†è§£ä»€ä¹ˆæ˜¯å¸¸é‡è¡¨è¾¾å¼å’Œ `==` ä¸ `equals()` çš„åŒºåˆ«å§ã€‚
### å¸¸é‡è¡¨è¾¾å¼
è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¦å…ˆç†è§£å¸¸é‡è¡¨è¾¾å¼ã€‚
`å¸¸é‡è¡¨è¾¾å¼`ï¼šæŒ‡ä»£è¡¨åŸºæœ¬æ•°æ®ç±»å‹æˆ–è€… `String` æ•°æ®ç±»å‹çš„è¡¨è¾¾å¼ï¼Œèƒ½åœ¨**ç¼–è¯‘æœŸé—´èƒ½è®¡ç®—å‡ºæ¥çš„å€¼**ï¼Œå› æ­¤è¡¨è¾¾å¼ä¸­çš„å‡éœ€ä¸ºå¸¸é‡ï¼Œä¸å¯ä¸ºå˜é‡ã€‚
å¯¹äºå¸¸é‡è¡¨è¾¾å¼ï¼ŒJava ç¼–è¯‘æ—¶ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œç›´æ¥èµ‹äºˆè®¡ç®—åçš„å¸¸é‡å€¼ã€‚
<br/>

### `==` å’Œ `equals()`
- `==` ï¼š åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡ï¼Œå³åˆ¤æ–­å¼•ç”¨çš„æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡ã€‚
- `equals()`ï¼šåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸åŒã€‚ç±»ä¸­é»˜è®¤çš„ `equals()` åŒ `==` åˆ¤æ–­ï¼Œä½†å¯è¢«è‡ªå®šä¹‰è¦†ç›–ã€‚
<br/>

### ä¸¾ä¾‹
äº†è§£äº†å¸¸é‡è¡¨è¾¾å¼ï¼Œæ¥çœ‹çœ‹ä¸‹é¢çš„å®ä¾‹ã€‚

```java
private final static String staticA = "AAA";   // å¸¸é‡
private final static String staticB = "111";   // å¸¸é‡
private final static String staticC;
private final static String staticD;
private final static String staticE;
static {
    staticC = "AAA";
    staticD = "111";
    staticE = "AAA111";
}

public static void main(String[] args) {
    String str0 = "AAA111";
    String str1 = "AAA" + "111";
    String str2 = staticA + staticB;
    String str3 = staticC + staticD;
    String str4 = "AAA" + 111;
    String str5 = staticA + 111;
    String str6 = staticC + 111;
    String str7;
    str7 = staticC + staticD;
    String str8;
    str8 = str7 + "";
    
    String str9 = str8.intern();
    System.out.println(str0 == str8);	// true
}
```
çœ‹å¦‚ä¸‹ä»£ç ï¼Œå…¶ä¸­ `str0~str8` çš„å€¼å‡ä¸º `AAA111`ã€‚
ä½†å½“å½¼æ­¤è¿›è¡Œ `==` æ“ä½œæ—¶ï¼Œå´ä¸å‡ä¸º `true`ï¼Œè¯´æ˜åº•å±‚å¹¶æœªæŒ‡å‘ç›¸åŒçš„å¯¹è±¡ã€‚
<br/>
`staticE, str0, str1, str2, str4, str5,str9` å½¼æ­¤è¿›è¡Œ `==` åˆ¤æ–­æ—¶ï¼Œä¸º `true`ã€‚
`staticA == staticCï¼ŒstaticB == staticD` ä¸º `true`ã€‚
`str3, str6, str7, str8` å½¼æ­¤å‡ä¸º `false`ã€‚

![](http://img.wenchao.wang/20190310212850_gIYMfF_Screenshot.jpeg)
æ­¤å›¾ä¸º Java8 ç¤ºæ„ï¼ŒJava8 ä¹‹å‰çš„è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯åœ¨æ–¹æ³•åŒºã€‚
<br/>
å¯¹ä»¥ä¸Šä»£ç åˆ†æï¼š
`staticA ~ staticE` äº”ä¸ªå˜é‡ï¼Œå‡ä¸º `final`å¸¸é‡ã€‚ä½† `staticC~staticE` ä¸ `staticAï¼ŒstaticB` ç•¥æœ‰åŒºåˆ«ï¼Œ`staticC~staticD` è™½ç„¶æ˜¯å¸¸é‡ï¼Œä½†åœ¨ç¼–è¯‘æœŸæœªè¢«èµ‹å€¼ï¼Œæ˜¯åˆ°è¿è¡Œæ—¶æ‰è¢«èµ‹å€¼ï¼Œå› æ­¤æ€§è´¨ç±»ä¼¼äºä¸€ä¸ªå˜é‡ï¼Œä¸å¯è§†ä¸ºç¼–è¯‘æ—¶å¸¸é‡ã€‚`staticE` ä¹Ÿæ˜¯å˜é‡ï¼Œä½†èµ‹å€¼ç›´æ¥ä¸º `AAA111`ã€‚

`str0~str8` éƒ¨åˆ†ï¼Œå‡ä¸ºæ ˆå†…å®šä¹‰çš„å˜é‡ã€‚
1. `str0` åœ¨ç¼–è¯‘æ—¶ï¼Œç›´æ¥èµ‹å€¼ï¼Œæ‰§è¡Œçš„æ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚`AAA111` å…¥å¸¸é‡æ± ï¼Œstr0 ä¸ºå…¶å¼•ç”¨ã€‚
2. `str1` åœ¨ç¼–è¯‘æ—¶ï¼Œæ˜¯ç”±ä¸¤ä¸ªå¸¸é‡ `AAA` å’Œ `111` è¿æ¥æ‰€å¾—ï¼Œå€¼ä¹Ÿå¯ä»¥ç¡®å®šã€‚ç”±äº `str0` æ—¶ï¼Œå·²ç»å°† `AAA111` æ”¾å…¥å¸¸é‡æ± ï¼Œå› æ­¤ `str1` å¤ç”¨ï¼Œå¼•ç”¨åŒä¸€å¸¸é‡æ± å¯¹è±¡ã€‚
3. `str2` æ˜¯ `staticA` å’Œ `staticB` è¿æ¥ï¼Œç”±äº `staticAï¼ŒstaticB` å€¼æ˜¯å¸¸é‡ï¼Œæ‰§è¡Œçš„æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œå¼•ç”¨å¸¸é‡æ± ã€‚
4. `str3` æ˜¯ `staticC` å’Œ `staticD` è¿æ¥ï¼Œä½†  `staticC` å’Œ `staticD` æœªè¢«ç›´æ¥èµ‹å€¼ï¼Œç¼–è¯‘æœŸæ— æ³•å†³å®šå€¼ã€‚
5. `str4` å’Œ `str5` å‡èƒ½åœ¨ç¼–è¯‘æœŸå†³å®šå€¼ï¼Œå› æ­¤ä¹Ÿå¼•ç”¨å¸¸é‡æ± 
6. `str6~str8` å‡æ— æ³•åœ¨ç¼–è¯‘æœŸå†³å®šå€¼ï¼Œå› æ­¤ä¸å¼•ç”¨å¸¸é‡æ± ã€‚
7. `str9` ä½¿ç”¨äº† `String.inertn()`ï¼Œ**è‹¥å­—ç¬¦ä¸²å·²åœ¨å¸¸é‡æ± å­˜åœ¨ï¼Œåˆ™å¼•ç”¨å·²æœ‰å¸¸é‡æ± å¯¹è±¡ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ‰‹åŠ¨å°†å­—ç¬¦ä¸²æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå¹¶å¼•ç”¨**ã€‚

<br/>
è®¨è®ºå®Œå¸¸é‡æ± çš„æƒ…å†µï¼Œå†æ¥çœ‹çœ‹å †çš„æƒ…å†µã€‚
```java
String sA = "ABCD";
String sB = new String("ABCD");
String sC = new String("ABCD").intern();
System.out.println(sA == sB);   // false
System.out.println(sA == sC);   // true
System.out.println(sB == sC);   //false
```
å¦‚ä¸Šä»£ç ï¼Œå½“ `new` ä¸€ä¸ªå¯¹è±¡æ—¶ï¼ŒJava ä¼šå°†å…¶æ”¾ç½®äºå †ä¸­ã€‚å› æ­¤ï¼Œæ˜¾ç„¶ä¸ä¼šä¸å¸¸é‡æ± ä¸­çš„å¼•ç”¨ç›¸ç­‰ï¼Œ`sA == sB` ä¸º falseã€‚
ä½†å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå¦‚æœä¸»åŠ¨è°ƒç”¨ `String.intern()` æ–¹æ³•ï¼Œåˆ™ä¼šå°†å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ï¼Œæ­¤å¤„ `ABCD` å­—ç¬¦ä¸²å·²å­˜åœ¨ï¼Œå› æ­¤`sC` ç›´æ¥å¼•ç”¨å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚
<br/>
ä»”ç»†åˆ†æå¯çŸ¥ï¼Œåœ¨ `new String("ABCD")` æ—¶ï¼Œå¯èƒ½åˆ›å»ºä¸€ä¸ªæˆ–ä¸¤ä¸ªå¯¹è±¡ã€‚è‹¥ `new` çš„å­—ç¬¦ä¸²å·²ç»å­˜åœ¨ï¼Œåˆ™ä»…ä¼šåœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä½†è‹¥å­—ç¬¦ä¸²ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå…ˆåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºï¼Œç„¶åå†å †ä¸­åˆ›å»ºå¯¹è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚
<br/>

# String å®è·µ
è¿™éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯æ€»ç»“ ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹13ç« å­—ç¬¦ä¸²ç« èŠ‚ã€‚
## JDK ä¸­ `+` çš„é‡è½½ä¸ `StringBuilder` ä¼˜åŒ–
ç”±äº `String` å¯¹è±¡çš„ä¸å¯å˜ã€‚æ¯æ¬¡å¯¹å­—ç¬¦ä¸²çš„å˜æ›´ï¼Œå‡ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå‡ºç°ä¸‹é¢æƒ…å†µæ—¶ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„ä¸­é—´å˜é‡ï¼Œä½¿å¾—ä»£ç æ•ˆç‡é™ä½ã€‚
```java
String hello = "h" + "e" + "l" + "l" + "o";
```
è‹¥ä¸è¿›è¡Œä¼˜åŒ–ï¼Œä¸Šé¢ä»£ç ä¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»º `h, e, l, o, he, hel, hell, hello`ï¼Œè¿™ä¹ˆå¤šä¸­é—´å¯¹è±¡ã€‚
Java å¯¹æ­¤è¿›è¡Œäº†ä¼˜åŒ–ã€‚
<br/>
ä»¥ä¸‹ä»£ç ä¸ºä¾‹
```java
public static void main(String[] args) {
	String str1 = "abc";
	String str2 = str1 + "h" + "e" + "l" + "l" + "o";
}
```
åˆ©ç”¨ JDK æä¾›çš„ `javap -c XXXX` åç¼–è¯‘å·¥å…·ï¼Œå¯ä»¥çœ‹åˆ°åº•å±‚å®ç°ã€‚
```               
0: ldc           #2                  // String abc
2: astore_1
3: new           #3                  // class java/lang/StringBuilder
6: dup
7: invokespecial #4                  // Method java/lang/StringBuilder."<init>":()V
10: aload_1
11: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
14: ldc           #6                  // String h
16: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
19: ldc           #7                  // String e
21: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
24: ldc           #8                  // String l
26: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
29: ldc           #8                  // String l
31: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
34: ldc           #9                  // String o
36: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
39: invokevirtual #10                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
42: astore_2
```
å¯ä»¥å‘ç°ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å¼•å…¥äº† `StringBuilder` ç±»ï¼Œåœ¨æ¯æ¬¡é‡è½½ `+` æ—¶ï¼Œåº•å±‚å‡è°ƒç”¨ä¸€æ¬¡ `StringBuilder.append()` æ–¹æ³•ã€‚è¿™å‡å°‘äº†ä¸­é—´å¯¹è±¡ï¼Œæé«˜äº†æ•ˆç‡ã€‚

è™½ç„¶ç¼–è¯‘å™¨ä¼šå¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–ï¼Œä½†ç”¨ `+` æ•ˆç‡è¿˜æ˜¯æ¯”è¾ƒä½ã€‚è¿™æ˜¯å› ä¸ºæ¯æ¬¡æ‰§è¡Œå­—ç¬¦ä¸² `+`ï¼Œéƒ½ä¼šåˆ›å»º `StringBuilder`å¯¹è±¡ã€‚
```java
String str1 = "";
for (int i = 0; i < 100; i++) {
    str1 += i;
}
```
å¯¹åº”åç¼–è¯‘å­—èŠ‚ç ä¸ºï¼Œä» 6~18 è¡Œä¸ºå¾ªç¯ï¼Œç¬¬ 10è¡Œï¼Œä¼šåˆ›å»º `StringBuilder` å¯¹è±¡ã€‚åœ¨å¾ªç¯ä¸­ï¼Œåˆ›å»ºå¯¹è±¡ï¼Œè°ƒç”¨äº†ä¸¤æ¬¡ `append()` æ–¹æ³•å’Œä¸€æ¬¡ `toString()` æ–¹æ³•ï¼Œæ•ˆç‡ä¸é«˜ã€‚
```
0: ldc           #2                  // String
2: astore_1
3: iconst_0
4: istore_2
5: iload_2
6: bipush        100
8: if_icmpge     36
11: new           #3                  // class java/lang/StringBuilder
14: dup
15: invokespecial #4                  // Method java/lang/StringBuilder."<init>":()V
18: aload_1
19: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
22: iload_2
23: invokevirtual #6                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
26: invokevirtual #7                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
29: astore_1
30: iinc          2, 1
33: goto          5
```
å› æ­¤è¿˜æ˜¯æ¨èä¸»åŠ¨åˆ›å»º `StringBuilder` å¯¹è±¡ã€‚å¯ä»¥ä¼˜åŒ–ä¸º
```java
String str1 = "";
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 100; i++) {
    sb.append(i);
}
str1 = sb.toString();
```
åç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨å¾ªç¯å¤–åˆ›å»ºäº†ä¸€æ¬¡ `StringBuilder`ï¼Œå¹¶ä¸”å¾ªç¯å†…ä¹Ÿåªè°ƒç”¨äº†ä¸€æ¬¡ `append()` æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨äº†ä¸€æ¬¡ `toString()`ã€‚
```
0: ldc           #2                  // String
2: astore_1
3: new           #3                  // class java/lang/StringBuilder
6: dup
7: invokespecial #4                  // Method java/lang/StringBuilder."<init>":()V
10: astore_2
11: iconst_0
12: istore_3
13: iload_3
14: bipush        100
16: if_icmpge     31
19: aload_2
20: iload_3
21: invokevirtual #5                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
24: pop
25: iinc          3, 1
28: goto          13
31: aload_2
32: invokevirtual #6                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
35: astore_1
```
<br/>

## é¿å… `toString()` æ— æ„è¯†çš„é€’å½’
Java çš„æ‰€æœ‰ç±»å‡ç»§æ‰¿äº `Object`ï¼Œå› æ­¤æ‰€æœ‰ç±»å‡å¯é‡å†™ `toString()` æ–¹æ³•ï¼Œ`toString` æ–¹æ³•å¸¸è¢«ç”¨äºæ‰“å°å¯¹è±¡çš„åŸºæœ¬ä¿¡æ¯ã€‚
ä½†å¦‚æœåœ¨ `toString` æ–¹æ³•ä¸­ï¼Œç”¨åˆ°äº† `this`ï¼Œä¾¿ä¼šå‡ºç°æ— é™é€’å½’ï¼ŒæŠ¥ `StackOverflowError` å¼‚å¸¸ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š
```java
public class InfRec {
    @Override
    public String toString() {
        return "InfRec" + this;
    }

    public static void main(String[] args) {
        System.out.println(new InfRec());
    }
}
```
åº”è¯¥å°† `this` æ”¹ä¸º `super.toString()`ï¼›

<br/>

## `StringBuilder` vs `StringBuffer`
- `StringBuilder`ï¼šéçº¿æ€§å®‰å…¨ï¼Œæ•ˆç‡æ›´é«˜ï¼Œäº Java 5ä¸­åŠ å…¥
- `StringBuffer`ï¼šçº¿æ€§å®‰å…¨ï¼Œä½¿ç”¨äº† `synchronized` å…³é”®å­—ã€‚æ•ˆç‡ä½ï¼Œä¸æ¨èä½¿ç”¨ï¼Œå³ä½¿æ˜¯å¤šçº¿ç¨‹ç¯å¢ƒï¼Œä¹Ÿæœ‰æ›´å¥½çš„æ–¹æ¡ˆã€‚

<br/>

> æ›´å¤š `String` ä½¿ç”¨ï¼Œå‚è€ƒ JDK æºç 

<br/>

# æ€»ç»“
1. `String` ä¸æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªç±»ï¼Œé»˜è®¤å€¼æ˜¯ `null` è€Œé `""`ã€‚
2. `String` æ˜¯ç”± `char[]` æ„æˆï¼ŒJava å†…ç é‡‡ç”¨ `UTF-16` å¯¹ unicode ç¼–ç ã€‚å› æ­¤å­˜åœ¨ä¸€ä¸ªå­—ç¬¦é•¿åº¦ä¸º 2çš„æƒ…å†µï¼Œå¦‚ ğŸ˜‚ å¯¹åº”çš„ `\uD83D\uDE02` ã€‚
3. `String` ä¸ºå¸¸é‡ï¼Œä¸€æ—¦å®šä¹‰ä¸å¯å˜æ›´ã€‚è‹¥ä¿®æ”¹ï¼Œä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚
4. `String` ä¼ é€’æ—¶ä¸ºå¼•ç”¨æ‹·è´ã€‚
5. é€šè¿‡å®šä¹‰å¸¸é‡æˆ–è€…å¸¸é‡è¡¨è¾¾å¼ï¼Œå¯ä»¥äºç¼–è¯‘æœŸç¡®å®š `String`çš„å€¼çš„ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²æ”¾å…¥ class é™æ€å¸¸é‡æ± ï¼Œå½“ç±»åŠ è½½æ—¶ï¼Œè½½å…¥è‡³è¿è¡Œæ—¶å¸¸é‡æ± ã€‚
6. å¯é€šè¿‡ `String.intern()` æ–¹æ³•ï¼Œä¸»åŠ¨å°†å­—ç¬¦ä¸²æ”¾ç½®å…¥å¸¸é‡æ± ï¼Œè‹¥å¸¸é‡æ± å·²å­˜åœ¨è¯¥å­—ç¬¦ä¸²ï¼Œä¼šç›´æ¥å¼•ç”¨ã€‚è‹¥ä¸ä¸»åŠ¨è°ƒç”¨ `intern()` æ–¹æ³•ï¼ŒJVM ä¸ä¼šä¸»åŠ¨å°†å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ã€‚
7. `new String("ABCD")` è¿‡ç¨‹ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæˆ–ä¸¤ä¸ªå¯¹è±¡ï¼Œæˆ–æœ‰ä¸€ä¸ªä½äºå¸¸é‡æ± ï¼Œå¦ä¸€ä¸ªä½äºå †ä¸­ã€‚
8. å½“ä»£ç æ¶‰åŠè¾ƒå¤šå­—ç¬¦ä¸² `+` æ“ä½œæ—¶ï¼Œä½¿ç”¨ `StringBuilder` èƒ½æé«˜æ•ˆç‡
9. ä¸è¦åœ¨ `toString` æ–¹æ³•ä¸­ä½¿ç”¨ `this`ï¼Œé¿å…æ— é™é€’å½’ï¼Œåº”è¯¥ç”¨ `super.toString()`
10. `StringBuilder` éçº¿æ€§å®‰å…¨ï¼Œ`StringBuffer` ä½¿ç”¨äº†`synchronized` å…³é”®å­—ï¼Œæ•ˆç‡ä½ï¼Œä¸æ¨èä½¿ç”¨ã€‚

<br/>

# å‚è€ƒèµ„æ–™
[1] æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼šJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µï¼ˆç¬¬2ç‰ˆï¼‰ï¼Œä½œè€…å‘¨å¿—æ˜
[2] ã€ŠJava ç¼–ç¨‹æ€æƒ³ã€‹ç¬¬4ç‰ˆï¼Œä½œè€… Bruce Eckel
[3] classæ–‡ä»¶å¸¸é‡æ± å’Œè¿è¡Œæ—¶å¸¸é‡æ± æ¯”å¯¹ï¼Œ http://www.ifcoding.com/archives/284.html
[4] ä»€ä¹ˆæ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Ÿï¼Œ http://www.importnew.com/10756.html
[5] Javaç¯‡-Stringè¯¦è§£ï¼Œ TianTianBaby223ï¼Œhttps://www.jianshu.com/p/d832752caf0c
[6] Javaå¸¸ç”¨ç±»ï¼ˆäºŒï¼‰Stringç±»è¯¦è§£ï¼Œ https://www.cnblogs.com/zhangyinhua/p/7689974.html
[7] Stringç±»è¯¦è§£ï¼Œ https://juejin.im/post/59f6eb076fb9a045154329cc
[8] Top 10 questions of Java Stringsï¼Œhttp://www.programcreek.com/2013/09/top-10-faqs-of-java-strings/
[9] Javaä¸­Stringè¯¦è§£ï¼Œä½œè€… Lolitaï¼Œ https://zhuanlan.zhihu.com/p/29629508